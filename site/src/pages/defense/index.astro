---
// defense/index.astro - Defense lane index page
import BaseLayout from '../../layouts/BaseLayout.astro';
import LaneBadge from '../../components/LaneBadge.astro';
import PostCard from '../../components/PostCard.astro';
import { getCollection } from 'astro:content';

// Get all defense posts
const allPosts = await getCollection('posts', ({ data }) => !data.draft && data.lane === 'defense');
const sortedPosts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Calculate reading times
const postsWithReadingTime = sortedPosts.map((post) => ({
  ...post,
  readingTime: Math.ceil(post.body.split(/\s+/).length / 225)
}));
---

<BaseLayout title="// Defense" description="Risk engineering, organizational patterns, and compliance reality.">
  <div class="mb-8">
    <LaneBadge lane="defense" />
    <h1 class="text-3xl font-bold text-[#f1f5f9] mt-4 mb-4">
      Defense
    </h1>
    <p class="text-lg text-[#94a3b8]">
      Risk engineering, organizational patterns, and compliance reality.
    </p>
  </div>

  {postsWithReadingTime.length > 0 ? (
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {postsWithReadingTime.map((post) => (
        <PostCard
          title={post.data.title}
          slug={post.slug}
          date={post.data.date}
          lane={post.data.lane}
          description={post.data.description}
          readingTime={post.readingTime}
        />
      ))}
    </div>
  ) : (
    <div class="bg-[#111827] border border-[#1e293b] rounded-xl p-12 text-center">
      <p class="text-[#64748b]">Coming soon</p>
    </div>
  )}
</BaseLayout>
